<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Huibers Auto's</title>
    <link rel="stylesheet" href="css/stylesheet.css" type="text/css"/>

</head>
<body>


<div id="main">
    <h2>login</h2>
    <form id="loginform">
        <label for="username">Username:</label><input type="text" id="username" name="username"/><br>
        <label for="password">Wachtwoord:</label><input type="text" id="password" name="password"/><br>
    </form>

    <button type="button" name="profile" id="profile"> profile!</button>
    <button type="button" name=login" id="login"> login</button>
    <p></p>
    <a href="admin.html">functies admin</a>


    <br>
    <hr>
    <br>
</div>


<script type="text/javascript">

    function login(event) {
        var formData = new FormData(document.querySelector("#loginform"));
        var encData = new URLSearchParams(formData.entries());

        fetch("restservices/authentication", {method: "POST", body: encData})
            .then(function (response) {
                if (response.ok) return response.json();
                else throw "wrong username/password";
            })
            .then(myJson => window.sessionStorage.setItem("myJWT", myJson.JWT)
                .catch(error => console.log(error)));
    }

    document.querySelector("#login").addEventListener("click", login);

    document.querySelector("#profile").addEventListener("click", function () {
        var fetchoptions = {
            method: 'GET',
            headers: {
                'Authorization': 'bearer' + window.sessionStorage.getItem("myJWT")
            }


        };
        fetch("restservices/account/profile", fetchoptions)
            .then(response => response.json())
            .then(function (myJson) {
                console.log(myJson);

            });
    });


</script>


</body>
</html>